<div ng-controller="datasetController as datasetCtrl">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <h1>{{ datasetCtrl.dataset.full_name }}</h1>
            </div>
        </div>
        <div class="row">
            <div id="tab-bar">
                <my-navbar tab="download"></my-navbar>

                <div class="tab-content">
                    <div ng-switch on='datasetCtrl.authorization_level'>
                    <div ng-switch-when="loggedout">
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="dataset-body padding-tb">You need to login for this access</div>
                            </div>
                        </div>
                    </div>
                    <div ng-switch-when="need-access">
                        <h3>Request access to the dataset</h3>
                        <div class="row clearfix">
                            <div class="col-md-12 column">
                                <form class="form-horizontal" role="form" name="requestForm">
                                    <div class="form-group">
                                        <label for="user_name" class="col-sm-2 control-label">Name</label>
                                        <div class="col-sm-4">
                                            <input type="text" class="form-control" id="user_name" ng-model="datasetCtrl.user.user" ng-disabled="true" placeholder="Your name" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="email" class="col-sm-2 control-label">E-mail</label>
                                        <div class="col-sm-4">
                                            <input type="text" class="form-control" id="email" ng-model="datasetCtrl.user.email" ng-disabled="true" placeholder="Your e-mail" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="affiliation" class="col-sm-2 control-label">Affiliation</label>
                                        <div class="col-sm-4">
                                            <input type="text" class="form-control" id="affiliation" name="affiliation" required ng-model="datasetCtrl.user.affiliation" placeholder="Your affiliation" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="country" class="col-sm-2 control-label">Country</label>
                                        <div class="col-sm-4">
                                            <select name="country" class="form-control" id="country" ng-options="option.name for option in datasetCtrl.availableCountries track by option.name" ng-model="datasetCtrl.user.country" required>
                                                <option value="">-- Select Country --</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-2"></div>
                                        <div class="col-sm-4 checkbox">
                                            <label class="control-label">
                                                <input type="checkbox" id="newsletter" ng-model="datasetCtrl.user.newsletter">I want a newsletter</input>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-offset-2 col-sm-10">
                                            <input type="submit" class="btn btn-primary" ng-click="datasetCtrl.sendRequest(requestForm.$valid)" />
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="row clearfix">
                            <div class="col-md-1 column"></div>
                            <div class="col-md-8 column">
                                <p>By submitting the application for registration you confirm that the information provided in the application is accurate.</p>
                                <p>By submitting the application for registration you also agree to have the information that you submit (Name, affiliation, country and email) handled in accordance with the Swedish Personal Data Act (Personuppgiftslagen, 1998:204). The stored information will only be used for internal administrative purposes and not shared with other parties.</p>
                            </div>
                        </div>
                    </div>
                    <div ng-switch-when='waits-for-access'>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="dataset-body padding-tb">Your access request is currently under review, thank you for your patience.</div>
                            </div>
                        </div>
                    </div>
                    <div ng-switch-when="has-access">
                        <h2>Terms of use for the {{ datasetCtrl.dataset.short_name }} dataset (release {{ datasetCtrl.dataset.version.version }})</h3>
                        <div ng-bind-html="datasetCtrl.dataset.version.terms"></div>

                        <h2>Download</h3>
                        <p>
                            <b>I hereby consent to the agreement:</b>
                            <input type="checkbox" ng-model="datasetCtrl.checked" ng-change="datasetCtrl.consented()">
                        </p>

                        <table class="table">
                            <tbody>
                            <tr ng-repeat="file in datasetCtrl.files" class="table">
                                <td>{{file.name}}</td>
                                <td><a class="btn btn-primary btn-download"
                                       ng-class="{'disabled': !datasetCtrl.checked}"
                                       download="{{file.name}}"
                                       href="{{file.uri}}"
                                       target="_self"
                                       ng-click="datasetCtrl.downloadData()">Download</a></td>
                            </tr>
                            </tbody>
                         </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
