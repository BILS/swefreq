<div ng-controller="datasetAdminController as adminCtrl">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <h1>{{ adminCtrl.dataset.full_name }}</h1>
            </div>
        </div>
        <div class="row">
            <div id="tab-bar">
                <my-navbar tab="admin"></my-navbar>

                <div ng-if="adminCtrl.dataset.is_admin == false">
                    <p>You need to be logged in as an admin to use this page.
                </div>
                <div ng-if="adminCtrl.dataset.is_admin == true">

                    <div class="tab-content">

                        <div class="container">
                            <div class="row">
                                <div class="admin-bar">
                                    <ul class="nav nav-tabs pull-right">
                                        <li class="active"><a data-target="#pending" data-toggle="tab">Pending requests</a></li>
                                        <li><a data-target="#approved" data-toggle="tab">Approved users</a></li>
                                        <li><a data-target="#emaillist" data-toggle="tab">Email list</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="tab-content">

                            <div class="tab-pane active" id="pending">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <tr>
                                            <th></th>
                                            <th>Name</th>
                                            <th>E-mail</th>
                                            <th>Affiliation</th>
                                            <th>Country</th>
                                            <th>Applied date</th>
                                        </tr>
                                        <tr ng-repeat="row in adminCtrl.users.pending">
                                            <td>
                                                <div class="btn btn-primary btn-xs" data-toggle="tooltip" title="Give the user access" ng-click="adminCtrl.approveUser(row)">Approve</div>
                                                <div class="btn btn-danger btn-xs" data-toggle="tooltip" title="Deny access" ng-click="adminCtrl.revokeUser(row)">Deny</div>
                                            </td>
                                            <td>{{row.user}}</td>
                                            <td>{{row.email}}</td>
                                            <td>{{row.affiliation}}</td>
                                            <td>{{row.country}}</td>
                                            <td>{{row.applyDate}}</td>
                                            <td><b ng-if="row.has_access">{{row.has_access}}</b></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <div class="tab-pane" id="approved">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <tr>
                                            <th></th>
                                            <th>Name</th>
                                            <th>E-mail</th>
                                            <th>Affiliation</th>
                                            <th>Country</th>
                                            <th>Applied date</th>
                                        </tr>
                                        <tr ng-repeat="row in adminCtrl.users.has_access">
                                            <td>
                                                <div class="btn btn-danger btn-xs" data-toggle="tooltip" title="Deny access" ng-click="adminCtrl.revokeUser(row)">Revoke</div>
                                            </td>
                                            <td>{{row.user}}</td>
                                            <td>{{row.email}}</td>
                                            <td>{{row.affiliation}}</td>
                                            <td>{{row.country}}</td>
                                            <td>{{row.applyDate}}</td>
                                            <td><b ng-if="row.has_access">{{row.has_access}}</b></td>
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <div class="tab-pane" id="emaillist">
                                <span ng-repeat="user in adminCtrl.users.has_access">
                                    <span ng-if="user.newsletter">
                                        {{user.email}}{{$last ? '' : ', '}}
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
